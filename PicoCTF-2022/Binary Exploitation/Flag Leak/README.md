# Flag Leak - 300 pts

### Key ideas

- Format string attack
- `printf()` in C

---

## **Contents**

- [Overview](#overview)
- [Solution](#solution)

---

## Overview

### Description

> I'm just copying and pasting with this program. What can go wrong? You can view source here. And connect with it using:

```
$ nc saturn.picoctf.net 65229
Tell me a story and then I'll tell you one >> wungus on top
Here's a story -
wungus on top
```
---

## Solution

The function we're interested in is `vuln()`:

```C
void vuln(){
   char flag[BUFSIZE];
   char story[128];

   readflag(flag, FLAGSIZE);

   printf("Tell me a story and then I'll tell you one >> ");
   scanf("%127s", story);
   printf("Here's a story - \n");
   printf(story);
   printf("\n");
}
```

This function is improperly printing the user's input using `printf()`. In fact, if we try to compile this program using gcc, the compiler will warn us:

```
clmazzac-picoctf@webshell:~$ gcc vuln.c
vuln.c: In function 'vuln':
vuln.c:32:11: warning: format not a string literal and no format arguments [-Wformat-security]
   32 |    printf(story);
      |           ^~~~~
vuln.c: In function 'main':
```

The `printf()` function is meant to be used like this:

```C
printf("The argument is: %s", "arg");
>>> The argument is: arg
```

`printf()` is meant to be supplied arguments which it will replace format strings (denoted by a % sign) with. We can supply our own format strings to get the program to return from the stack.

Creating a simple python program to iterate through format strings would be best practice, but I was able to find the flag manually.
Simply iterate through the format string `%(int)$s`
Eventually you find the flag to be `picoCTF{L34k1ng_Fl4g_0ff_St4ck_b840e879}`
